// import 'package:flutter/widgets.dart';
// import 'package:flutter_jin_player/constants/logger_tag.dart';
// import 'package:flutter_jin_player/controller/player_getx_controller.dart';
// import 'package:flutter_jin_player/interface/idanmaku.dart';

// import 'package:flutter_android_danmaku/flutter_android_danmaku.dart';
// import 'package:flutter_jin_player/models/danmaku_item.dart';
// import 'package:get/get.dart';

// class FlutterAndroidViewDanmaku extends IDanmaku {
//   CustomViewController? danmakuController;
//   FlutterAndroidViewDanmaku(playerGetxController);
//   // 烈焰弹幕使基本时长是3800毫秒
//   final int baseDurationMs = 3800;
//   PlayerGetxController? playerGetxController;

//   void setPlayerGetxController(PlayerGetxController controller) {
//     playerGetxController = controller;
//   }

//   // 初始化弹幕
//   @override
//   Widget? initDanmaku() {
//     playerGetxController?.logger.d("初始化弹幕");
//     return Obx(() {
//       // 显示区域
//       int areaIndex = playerGetxController!
//           .danmakuConfigOptions.danmakuArea.value.areaIndex;
//       List<DanmakuAreaItem> danmakuAreaItemList = playerGetxController!
//           .danmakuConfigOptions.danmakuArea.value.danmakuAreaItemList;
//       double area = danmakuAreaItemList.isNotEmpty &&
//               danmakuAreaItemList.length > areaIndex
//           ? danmakuAreaItemList[areaIndex].area
//           : 1.0;
//       return AspectRatio(
//         aspectRatio: area,
//         child: FlutterAndroidDanmakuView(
//           onViewCreated: (c) {
//             danmakuController = c;
//           },
//           danmakuOptions: getDanmakuOptions(),
//         ),
//       );
//     });
//   }

//   DanmakuOptions getDanmakuOptions() {
//     // 显示区域
//     // int areaIndex =
//     //     playerGetxController?.danmakuConfigOptions.danmakuArea.value.areaIndex;
//     // List<DanmakuAreaItem> danmakuAreaItemList = playerGetxController
//     //     .danmakuConfigOptions.danmakuArea.value.danmakuAreaItemList;
//     // double area =
//     //     danmakuAreaItemList.isNotEmpty && danmakuAreaItemList.length > areaIndex
//     //         ? danmakuAreaItemList[areaIndex].area
//     //         : 1.0;

//     // 弹幕速度
//     double second =
//         playerGetxController!.danmakuConfigOptions.danmakuSpeed.value.speed /
//             playerGetxController!.playConfigOptions.playSpeed.value;

//     DanmakuOptions danmakuOptions = DanmakuOptions(
//       isStart: true,
//       isShowCache: true,
//       isShowFPS: true,
//       danmakuPath: playerGetxController!
//           .danmakuConfigOptions.danmakuSourceItem.value.path,
//       danmakuAlphaRatio: playerGetxController!
//               .danmakuConfigOptions.danmakuAlphaRatio.value.ratio /
//           100.0,
//       danmakuFontSizeRatio: playerGetxController!
//               .danmakuConfigOptions.danmakuFontSize.value.size *
//           (playerGetxController!
//                   .danmakuConfigOptions.danmakuFontSize.value.ratio /
//               100.0),
//       danmakuSpeed: second * 1000.0 / baseDurationMs,
//       danmakuStyleStroke: playerGetxController!
//           .danmakuConfigOptions.danmakuStyleStrokeWidth.value.strokeWidth,
//     );
//     for (DanmakuFilterType filterType
//         in playerGetxController!.danmakuConfigOptions.danmakuFilterType) {
//       switch (filterType.enName) {
//         case "fixedTop":
//           danmakuOptions.fixedTopDanmakuVisibility = filterType.filter.value;
//           break;

//         case "fixedBottom":
//           danmakuOptions.fixedBottomDanmakuVisibility = filterType.filter.value;
//           break;
//         case "scroll":
//           danmakuOptions.l2RDanmakuVisibility = filterType.filter.value;
//           danmakuOptions.r2LDanmakuVisibility = filterType.filter.value;
//           break;
//         case "repeat":
//           danmakuOptions.duplicateMergingEnable = filterType.filter.value;
//           break;
//         case "color":
//           danmakuOptions.colorsDanmakuVisibility = filterType.filter.value;
//           break;
//       }
//     }
//     return danmakuOptions;
//   }

//   // 发送弹幕
//   @override
//   void sendDanmaku(DanmakuItem danmakuItem) {
//     danmakuController?.sendDanmaku(danmakuItem.content,
//         time: danmakuItem.time < 0 ? null : danmakuItem.time.toString(),
//         danmakuType: danmakuItem.mode,
//         textSize: danmakuItem.fontSize,
//         textColor: danmakuItem.color);
//   }

//   // 发送弹幕列表
//   @override
//   void sendDanmakuList(List<DanmakuItem> danmakuItemList) {
//     for (DanmakuItem danmakuItem in danmakuItemList) {
//       sendDanmaku(danmakuItem);
//     }
//   }

//   // 启动弹幕
//   @override
//   Future<bool?> startDanmaku({double? startTime}) {
//     playerGetxController?.logger.d("进入启动弹幕方法");
//     if (!playerGetxController!.danmakuConfigOptions.initialized.value ||
//         playerGetxController?.danmakuConfigOptions.danmakuView.value == null) {
//       playerGetxController?.danmakuControl.initDanmaku();
//     }

//     try {
//       playerGetxController?.logger.d("启动弹幕");
//       int adjust = playerGetxController!
//           .danmakuConfigOptions.adjustTime.value.seconds.inMilliseconds;
//       danmakuController?.startDanmaku(startTime == null
//           ? (playerGetxController!
//                   .playConfigOptions.positionDuration.value.inMilliseconds +
//               adjust)
//           : (startTime + adjust).floor());
//     } catch (e) {
//       playerGetxController?.danmakuConfigOptions.errorMsg("启动弹幕失败：$e");
//       playerGetxController?.logger
//           .d("${LoggerTag.danmakuLog}startDanmaku，启动弹幕失败：$e");
//       return Future.value(false);
//     }
//     return Future.value(true);
//   }

//   // 暂停弹幕
//   @override
//   Future<bool?> pauseDanmaku() {
//     try {
//       danmakuController?.pauseDanmaKu();
//     } catch (e) {
//       playerGetxController?.danmakuConfigOptions.errorMsg("暂停弹幕失败：$e");
//       playerGetxController?.logger
//           .d("${LoggerTag.danmakuLog}pauseDanmaku，暂停弹幕失败：$e");
//       return Future.value(false);
//     }
//     return Future.value(true);
//   }

//   // 继续弹幕
//   @override
//   Future<bool?> resumeDanmaku() {
//     try {
//       danmakuController?.resumeDanmaku();
//     } catch (e) {
//       playerGetxController?.danmakuConfigOptions.errorMsg("继续弹幕失败：$e");
//       playerGetxController?.logger
//           .d("${LoggerTag.danmakuLog}resumeDanmaku，继续弹幕失败：$e");
//       return Future.value(false);
//     }
//     return Future.value(true);
//   }

//   // 弹幕跳转
//   @override
//   Future<bool?> danmakuSeekTo(double time) {
//     if (!playerGetxController!.playConfigOptions.initialized.value ||
//         playerGetxController!.playConfigOptions.finished.value) {
//       return Future.value(true);
//     }
//     try {
//       danmakuController?.danmaKuSeekTo((time.seconds +
//               playerGetxController!
//                   .danmakuConfigOptions.adjustTime.value.seconds)
//           .inMilliseconds
//           .floor());
//     } catch (e) {
//       playerGetxController?.danmakuConfigOptions.errorMsg("弹幕跳转失败：$e");
//       playerGetxController?.logger
//           .d("${LoggerTag.danmakuLog}danmakuSeekTo，弹幕跳转失败：$e");
//       return Future.value(false);
//     }
//     return Future.value(true);
//   }

//   // 显示/隐藏弹幕
//   @override
//   Future<bool?> setDanmakuVisibility(bool visible) {
//     if (!playerGetxController!.playConfigOptions.initialized.value ||
//         playerGetxController!.playConfigOptions.finished.value) {
//       return Future.value(true);
//     }
//     try {
//       playerGetxController?.danmakuConfigOptions.visible(visible);
//       // 如果设置显示弹幕，且视频已经初始化未播放结束，弹幕插件未初始化
//       if (visible &&
//           playerGetxController!.playConfigOptions.initialized.value &&
//           !playerGetxController!.playConfigOptions.finished.value &&
//           (!playerGetxController!.danmakuConfigOptions.initialized.value ||
//               playerGetxController?.danmakuConfigOptions.danmakuView.value ==
//                   null)) {
//         playerGetxController?.danmakuControl.initDanmaku();
//         // 视频正在播放，就需要播放弹幕
//         if (playerGetxController!.playConfigOptions.playing.value) {
//           playerGetxController?.danmakuControl.resumeDanmaku();
//         }
//       }
//       danmakuController?.setDanmaKuVisibility(visible);
//     } catch (e) {
//       playerGetxController?.danmakuConfigOptions.errorMsg("显示/隐藏弹幕失败：$e");
//       playerGetxController?.logger
//           .d("${LoggerTag.danmakuLog}setDanmakuVisibility，显示/隐藏弹幕失败：$e");
//       return Future.value(false);
//     }
//     if (playerGetxController?.danmakuConfigOptions.visible.value != visible) {
//       playerGetxController?.danmakuConfigOptions.visible(visible);
//     }
//     return Future.value(true);
//   }

//   // 设置弹幕透明的（百分比）
//   @override
//   Future<bool?> setDanmakuAlphaRatio(double danmakuAlphaRatio) {
//     try {
//       danmakuController?.setDanmakuAlphaRatio(
//           danmakuAlphaRatio / 100.0 > 1.0 ? 1 : danmakuAlphaRatio / 100.0);
//     } catch (e) {
//       playerGetxController?.danmakuConfigOptions.errorMsg("设置弹幕透明度失败：$e");
//       playerGetxController?.logger
//           .d("${LoggerTag.danmakuLog}setDanmakuAlphaRatio，设置弹幕透明度失败：$e");
//       return Future.value(false);
//     }
//     if (playerGetxController!
//             .danmakuConfigOptions.danmakuAlphaRatio.value.ratio !=
//         danmakuAlphaRatio) {
//       playerGetxController?.danmakuConfigOptions.danmakuAlphaRatio.value.ratio =
//           danmakuAlphaRatio;
//     }
//     return Future.value(true);
//   }

//   // 设置弹幕显示区域
//   @override
//   Future<bool?> setDanmakuArea(double area, bool filter) {
//     try {
//       danmakuController?.setDanmakuDisplayArea(area);
//       danmakuController?.setAllowOverlap(filter);
//     } catch (e) {
//       playerGetxController?.danmakuConfigOptions.errorMsg("设置弹幕显示区域失败：$e");
//       playerGetxController?.logger
//           .d("${LoggerTag.danmakuLog}setDanmakuArea，设置弹幕显示区域失败：$e");
//       return Future.value(false);
//     }
//     int areaIndex =
//         playerGetxController!.danmakuConfigOptions.danmakuArea.value.areaIndex;
//     List<DanmakuAreaItem> danmakuAreaItemList = playerGetxController!
//         .danmakuConfigOptions.danmakuArea.value.danmakuAreaItemList;
//     DanmakuAreaItem configItem = danmakuAreaItemList[areaIndex];

//     if (configItem.area != area || configItem.filter != filter) {
//       playerGetxController?.danmakuConfigOptions.danmakuArea.value.areaIndex =
//           areaIndex;
//     }
//     return Future.value(true);
//   }

//   // 设置字体大小（百分比）
//   @override
//   Future<bool?> setDanmakuFontSize(double fontSizeRatio) {
//     try {
//       danmakuController?.setDanmakuFontSize(fontSizeRatio / 100);
//     } catch (e) {
//       playerGetxController?.danmakuConfigOptions.errorMsg("设置字体大小失败：$e");
//       playerGetxController?.logger
//           .d("${LoggerTag.danmakuLog}setDanmakuFontSize，设置字体大小失败：$e");
//       return Future.value(false);
//     }
//     if (playerGetxController
//             ?.danmakuConfigOptions.danmakuFontSize.value.ratio !=
//         fontSizeRatio) {
//       playerGetxController?.danmakuConfigOptions.danmakuFontSize.value.ratio =
//           fontSizeRatio;
//     }
//     return Future.value(true);
//   }

//   // 设置描边
//   @override
//   Future<bool?> setDanmakuStyleStrokeWidth(double strokeWidth) {
//     try {
//       danmakuController?.setDanmakuStroke(strokeWidth);
//     } catch (e) {
//       playerGetxController?.danmakuConfigOptions.errorMsg("设置描边失败：$e");
//       playerGetxController?.logger
//           .d("${LoggerTag.danmakuLog}setDanmakuStyleStrokeWidth，设置描边失败：$e");
//       return Future.value(false);
//     }
//     if (playerGetxController!
//             .danmakuConfigOptions.danmakuStyleStrokeWidth.value.strokeWidth !=
//         strokeWidth) {
//       playerGetxController?.danmakuConfigOptions.danmakuStyleStrokeWidth.value
//           .strokeWidth = strokeWidth;
//     }
//     return Future.value(true);
//   }

//   // 设置滚动速度
//   @override
//   Future<bool?> setDanmakuSpeed(double speed, double playSpeed) {
//     try {
//       danmakuController?.setDanmakuSpeed(speed / playSpeed);
//     } catch (e) {
//       playerGetxController?.danmakuConfigOptions.errorMsg("设置滚动速度失败：$e");
//       playerGetxController?.logger
//           .d("${LoggerTag.danmakuLog}setDanmakuSpeed，设置滚动速度失败：$e");
//       return Future.value(false);
//     }
//     if (playerGetxController?.danmakuConfigOptions.danmakuSpeed.value.speed !=
//         speed) {
//       playerGetxController?.danmakuConfigOptions.danmakuSpeed.value.speed =
//           speed;
//     }
//     return Future.value(true);
//   }

//   // 设置是否启用合并重复弹幕
//   @override
//   Future<bool?> setDuplicateMergingEnabled(bool flag) {
//     try {
//       danmakuController?.setDuplicateMergingEnabled(flag);
//     } catch (e) {
//       playerGetxController?.danmakuConfigOptions.errorMsg("设置是否启用合并重复弹幕失败：$e");
//       playerGetxController?.logger.d(
//           "${LoggerTag.danmakuLog}setDuplicateMergingEnabled，设置是否启用合并重复弹幕失败：$e");
//       return Future.value(false);
//     }
//     return Future.value(true);
//   }

//   // 设置是否显示顶部固定弹幕
//   @override
//   Future<bool?> setFixedTopDanmakuVisibility(bool visible) {
//     try {
//       danmakuController?.setFixedTopDanmakuVisibility(visible);
//     } catch (e) {
//       playerGetxController?.danmakuConfigOptions.errorMsg("设置是否显示顶部固定弹幕失败：$e");
//       playerGetxController?.logger.d(
//           "${LoggerTag.danmakuLog}setFixedTopDanmakuVisibility，设置是否显示顶部固定弹幕失败：$e");
//       return Future.value(false);
//     }
//     return Future.value(true);
//   }

//   // 设置是否显示滚动弹幕
//   @override
//   Future<bool?> setRollDanmakuVisibility(bool visible) {
//     try {
//       danmakuController?.setL2RDanmakuVisibility(visible);
//       danmakuController?.setR2LDanmakuVisibility(visible);
//     } catch (e) {
//       playerGetxController?.danmakuConfigOptions.errorMsg("设置是否显示滚动弹幕失败：$e");
//       playerGetxController?.logger
//           .d("${LoggerTag.danmakuLog}setRollDanmakuVisibility，设置是否显示滚动弹幕失败：$e");
//       return Future.value(false);
//     }
//     return Future.value(true);
//   }

//   // 设置是否显示底部固定弹幕
//   @override
//   Future<bool?> setFixedBottomDanmakuVisibility(bool visible) {
//     try {
//       danmakuController?.setFixedBottomDanmakuVisibility(visible);
//     } catch (e) {
//       playerGetxController?.danmakuConfigOptions.errorMsg("设置是否显示底部固定弹幕失败：$e");
//       playerGetxController?.logger.d(
//           "${LoggerTag.danmakuLog}setFixedBottomDanmakuVisibility，设置是否显示底部固定弹幕失败：$e");
//       return Future.value(false);
//     }
//     return Future.value(true);
//   }

//   // 设置是否显示特殊弹幕
//   @override
//   Future<bool?> setSpecialDanmakuVisibility(bool visible) {
//     try {
//       danmakuController?.setSpecialDanmakuVisibility(visible);
//     } catch (e) {
//       playerGetxController?.danmakuConfigOptions.errorMsg("设置是否显示特殊弹幕失败：$e");
//       playerGetxController?.logger.d(
//           "${LoggerTag.danmakuLog}setSpecialDanmakuVisibility，设置是否显示特殊弹幕失败：$e");
//       return Future.value(false);
//     }
//     return Future.value(true);
//   }

//   // 是否显示彩色弹幕
//   @override
//   Future<bool?> setColorsDanmakuVisibility(bool visible) {
//     try {
//       danmakuController?.setColorsDanmakuVisibility(visible);
//     } catch (e) {
//       playerGetxController?.danmakuConfigOptions.errorMsg("设置是否显示彩色弹幕失败：$e");
//       playerGetxController?.logger.d(
//           "${LoggerTag.danmakuLog}setColorsDanmakuVisibility，设置是否显示彩色弹幕失败：$e");
//       return Future.value(false);
//     }
//     return Future.value(true);
//   }

//   // 清空弹幕
//   @override
//   void clearDanmaku() {}

//   // 根据类型过滤弹幕
//   @override
//   void filterDanmakuType(DanmakuFilterType filterType) {}

//   // 调整弹幕时间
//   @override
//   void danmakuAdjustTime(double adjustTime) {}
// }
